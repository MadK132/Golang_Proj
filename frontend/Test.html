<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>“ö–∞–∑–∞“õ —Ç—ñ–ª—ñ –∫—É—Ä—Å—ã</title>
  <link rel="stylesheet" href="/static/styles.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .wrapper {
      display: flex;
      width: 100%;
      min-height: 100vh;
    }

    .sidebar {
      width: 250px;
      background: #000000;
      color: white;
      padding-top: 80px;
      position: fixed;
      left: 0;
      height: 100%;
      z-index: 99;
    }

    .main-content {
      margin-left: 250px;
      width: calc(100% - 250px);
      padding: 20px;
      padding-top: 80px;
    }

    .sidebar-menu {
      padding: 0;
      list-style: none;
    }

    .sidebar-menu li {
      padding: 15px 20px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }

    .sidebar-menu li a {
      color: white;
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .sidebar-menu li:hover {
      background: rgba(255,255,255,0.1);
    }

    .progress-section {
      padding: 20px;
    }

    .progress-bar {
      width: 100%;
      background: #333;
      height: 10px;
      border-radius: 5px;
      margin: 10px 0;
    }

    .progress-fill {
      height: 100%;
      background: #007bff;
      border-radius: 5px;
      width: 0%;
      transition: width 0.3s ease;
    }

    .progress-details {
      font-size: 14px;
    }

    .progress-details p {
      margin: 5px 0;
    }
  </style>
</head>
<body>
<header class="header py-3">
  <div class="container d-flex justify-content-between">
    <nav class="nav">
      <div class="nav-logo" style="padding-right: 20%">
        <p>STUDY</p>
      </div>
      <div class="nav-menu" id="navMenu">
        <ul>
          <li><a href="/" class="link">Home</a></li>
          <li><a href="/courses" class="link">Courses</a></li>
          <li><a href="/contact" class="link">Contact us</a></li>
        </ul>
      </div>
      <div class="nav-menu" id="navMenuu">
        <div class="nav-button">
          <ul>
            <li><a href="/login" id="Login" class="link">Log In / Sign Up</a></li>
            <li><span id="userGreeting" style="display: none;"></span></li>
          </ul>
        </div>
      </div>
    </nav>
    <button id="modeToggle" class="btn btn-outline-primary top-0 right-0 m-3">üåô</button>
    <button class="btn" id="logoutBtn" style="display: flex;" onclick="logout()">Log Out</button>
  </div>
</header>

<div class="wrapper">
  <!-- Sidebar -->
  <nav class="sidebar">
    <div class="progress-section">
      <h6>–ö—É—Ä—Å –ø—Ä–æ–≥—Ä–µ—Å—ñ</h6>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-info">
        <p>–¢—ñ–ª –±—ñ–ª—É –¥–µ“£–≥–µ–π—ñ: <span id="languageLevel">–ê–Ω—ã“õ—Ç–∞–ª–º–∞“ì–∞–Ω</span></p>
        <p>–ë–µ–π–Ω–µ —Å–∞–±–∞“õ—Ç–∞—Ä: <span id="videoProgress">0/10</span></p>
        <p>–¢–µ—Å—Ç—Ç–µ—Ä: <span id="quizProgress">0/5</span></p>
        <p>–ñ–∞–ª–ø—ã –ø—Ä–æ–≥—Ä–µ—Å—Å: <span id="totalProgress">0%</span></p>
      </div>
    </div>
    <ul class="sidebar-menu">
      <li>
        <a href="/video">
          <span>üì∫</span> –ë–µ–π–Ω–µ —Å–∞–±–∞“õ—Ç–∞—Ä
        </a>
      </li>
      <li>
        <a href="/quiz">
          <span>üìù</span> –¢–∞–ø—Å—ã—Ä–º–∞–ª–∞—Ä
        </a>
      </li>
      <li>
        <a href="/kazakh-quiz">
          <span>üéØ</span> –î–µ“£–≥–µ–π —Ç–µ—Å—Ç—ñ
        </a>
      </li>
    </ul>
  </nav>

  <!-- Main Content -->
  <div class="main-content">
    <div class="container">
      <h1>“ö–∞–∑–∞“õ —Ç—ñ–ª—ñ –∫—É—Ä—Å—ã</h1>
      <p>“ö–æ—à –∫–µ–ª–¥—ñ“£—ñ–∑! –ë“±–ª –∫—É—Ä—Å “õ–∞–∑–∞“õ —Ç—ñ–ª—ñ–Ω “Ø–π—Ä–µ–Ω—É–≥–µ –∞—Ä–Ω–∞–ª“ì–∞–Ω.</p>
      
      <!-- Your existing content here -->
    </div>
  </div>
</div>

<footer class="footer text-center py-3" style="position: relative ;">
  <p>SE-2304. All Rights Reserved.</p>
</footer>

<script>
  function toggleMode() {
    const body = document.body;
    const modeToggleButton = document.getElementById("modeToggle");
    const isLightMode = body.classList.contains("light-mode");

    if (isLightMode) {
      body.classList.remove("light-mode");
      body.classList.add("dark-mode");
      modeToggleButton.textContent = "üåû";
      localStorage.setItem("theme", "dark-mode");
    } else {
      body.classList.remove("dark-mode");
      body.classList.add("light-mode");
      modeToggleButton.textContent = "üåô";
      localStorage.setItem("theme", "light-mode");
    }
  }

  window.addEventListener("load", function() {
    const savedTheme = localStorage.getItem("theme");
    const body = document.body;
    const modeToggleButton = document.getElementById("modeToggle");

    if (savedTheme) {
      body.classList.remove("light-mode", "dark-mode");
      body.classList.add(savedTheme);

      if (savedTheme === "dark-mode") {
        modeToggleButton.textContent = "üåû";
      } else {
        modeToggleButton.textContent = "üåô";
      }
    } else {
      body.classList.add("light-mode");
      modeToggleButton.textContent = "üåô";
    }
  });

  document.getElementById("modeToggle").addEventListener("click", toggleMode);
  window.onload = function() {
    const currentUser = localStorage.getItem("currentUser");

    if (currentUser) {
      document.getElementById("Login").style.display = "none";
      document.getElementById("userGreeting").style.display = "inline";
      document.getElementById("userGreeting").textContent = `${currentUser}`;
      document.getElementById("logoutBtn").style.display = "inline";
    } else {
      document.getElementById("Login").style.display = "inline";
      document.getElementById("userGreeting").style.display = "none";
      document.getElementById("logoutBtn").style.display = "none";
    }
  }

  function logout() {
    localStorage.removeItem("currentUser");
    document.getElementById("Login").style.display = "inline";
    document.getElementById("userGreeting").style.display = "none";
    document.getElementById("logoutBtn").style.display = "none";
  }

  // Update progress bar
  function updateProgress(progress) {
    document.getElementById('progressFill').style.width = progress + '%';
    document.getElementById('progressText').textContent = progress + '%';
  }

  // Example functions for sidebar actions
  function showResources() {
    alert('Study Materials coming soon!');
  }

  function showGrammar() {
    alert('Grammar section coming soon!');
  }

  function showVocabulary() {
    alert('Vocabulary section coming soon!');
  }

  function showNotes() {
    alert('Notes section coming soon!');
  }

  // Initialize with some progress (example)
  updateProgress(30);

  // Add this function to update progress
  async function updateProgress() {
    const currentUser = localStorage.getItem("currentUser");
    if (!currentUser) return;

    try {
      const response = await fetch(`/user/progress/${currentUser}/kazakh`);
      if (response.ok) {
        const data = await response.json();
        
        document.getElementById('languageLevel').textContent = data.level;
        document.getElementById('videoProgress').textContent = 
            `${data.videos_completed}/${data.total_videos}`;
        document.getElementById('quizProgress').textContent = 
            `${data.quizzes_completed}/${data.total_quizzes}`;
        document.getElementById('totalProgress').textContent = 
            `${Math.round(data.percentage)}%`;
        document.getElementById('progressFill').style.width = 
            `${data.percentage}%`;
      }
    } catch (error) {
      console.error('Error fetching progress:', error);
    }
  }

  // Call updateProgress when page loads
  document.addEventListener('DOMContentLoaded', updateProgress);

  // Add this function to your video pages
  async function updateVideoProgress(videoId, completed) {
    const currentUser = localStorage.getItem("currentUser");
    if (!currentUser) return;

    try {
      const response = await fetch('/video/progress', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          user_id: currentUser,
          course: 'russian', // or 'kazakh' depending on the page
          video_id: videoId,
          completed: completed
        })
      });

      if (response.ok) {
        updateProgress(); // Update the progress bar
      }
    } catch (error) {
      console.error('Error updating video progress:', error);
    }
  }
</script>

</body>
</html>
